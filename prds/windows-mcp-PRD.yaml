# ============================================================================
# GRIMLOCK MCP SERVER PRD - Windows System Integration
# ============================================================================
# Purpose: MCP server for Windows system operations and automation
# Version: 1.0.0
# ============================================================================

# ----------------------------------------------------------------------------
# PROJECT METADATA
# ----------------------------------------------------------------------------
project:
  name: "windows-mcp"
  version: "0.1.0"
  description: |
    Windows System Integration MCP server providing AI assistants with the ability
    to interact with Windows operating system features including file management,
    process control, system information, clipboard operations, and shell execution.
    Enables Claude to help users automate Windows tasks and troubleshoot system issues.

  sdk: "typescript"
  node_version: "18+"

  deployment:
    type: "local"
    transport: "stdio"
    containerized: false

  delivery:
    method: "customer_repo"
    customer_repo_url: "https://github.com/m2ai-mcp-servers/mcp-windows"

# ----------------------------------------------------------------------------
# TARGET INTEGRATION
# ----------------------------------------------------------------------------
integration:
  service_name: "Windows OS"
  service_type: "filesystem"

  # No external API - uses Node.js native modules and PowerShell
  api:
    base_url: null
    documentation_url: "https://nodejs.org/api/"
    rate_limits: null

  auth:
    type: "none"

# ----------------------------------------------------------------------------
# MCP TOOLS SPECIFICATION
# ----------------------------------------------------------------------------
tools:
  # --- File System Tools ---
  - name: "list_directory"
    description: |
      List contents of a directory with optional filtering.
      Use when user wants to see files in a folder or search for specific file types.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Directory path to list (e.g., 'C:\\Users\\Name\\Documents')"
      - name: "filter"
        type: "string"
        required: false
        description: "File extension filter (e.g., '*.txt', '*.pdf')"
      - name: "recursive"
        type: "boolean"
        required: false
        default: false
        description: "Include subdirectories"
    behavior:
      returns: "array of file/folder objects with name, size, modified date, type"
      error_handling:
        - condition: "path_not_found"
          response: "Return error with suggested similar paths"
        - condition: "access_denied"
          response: "Inform user about permission requirements"

  - name: "read_file"
    description: |
      Read contents of a text file.
      Use when user wants to view file contents or analyze text data.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Full path to the file"
      - name: "encoding"
        type: "string"
        required: false
        default: "utf8"
        description: "File encoding (utf8, ascii, utf16le)"
    behavior:
      returns: "string with file contents"
      error_handling:
        - condition: "file_not_found"
          response: "Return error with path checked"
        - condition: "binary_file"
          response: "Inform user this appears to be a binary file"

  - name: "write_file"
    description: |
      Write or append content to a file.
      Use when user wants to create or modify text files.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Full path for the file"
      - name: "content"
        type: "string"
        required: true
        description: "Content to write"
      - name: "append"
        type: "boolean"
        required: false
        default: false
        description: "Append to existing file instead of overwrite"
    behavior:
      returns: "success confirmation with bytes written"
      error_handling:
        - condition: "access_denied"
          response: "Suggest running as administrator or different location"

  - name: "copy_file"
    description: |
      Copy a file or directory to a new location.
      Use when user wants to duplicate or backup files.
    parameters:
      - name: "source"
        type: "string"
        required: true
        description: "Source file or directory path"
      - name: "destination"
        type: "string"
        required: true
        description: "Destination path"
      - name: "overwrite"
        type: "boolean"
        required: false
        default: false
        description: "Overwrite if destination exists"
    behavior:
      returns: "success confirmation"

  - name: "move_file"
    description: |
      Move or rename a file or directory.
      Use when user wants to relocate or rename items.
    parameters:
      - name: "source"
        type: "string"
        required: true
        description: "Source path"
      - name: "destination"
        type: "string"
        required: true
        description: "Destination path"
    behavior:
      returns: "success confirmation with new path"

  - name: "delete_file"
    description: |
      Delete a file or empty directory.
      Use with caution - always confirm with user first.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Path to delete"
      - name: "recursive"
        type: "boolean"
        required: false
        default: false
        description: "Delete directory and all contents (dangerous)"
    behavior:
      returns: "success confirmation"
      error_handling:
        - condition: "in_use"
          response: "File is in use by another process"

  # --- Process Management Tools ---
  - name: "list_processes"
    description: |
      List running processes with CPU and memory usage.
      Use when user wants to see what's running or find resource-heavy apps.
    parameters:
      - name: "filter"
        type: "string"
        required: false
        description: "Filter by process name (partial match)"
      - name: "sort_by"
        type: "string"
        required: false
        default: "memory"
        description: "Sort by: memory, cpu, name, pid"
        validation:
          enum: ["memory", "cpu", "name", "pid"]
    behavior:
      returns: "array of process objects with pid, name, cpu%, memory"

  - name: "kill_process"
    description: |
      Terminate a running process by PID or name.
      Use when user wants to force-close an application.
    parameters:
      - name: "identifier"
        type: "string"
        required: true
        description: "Process ID (number) or process name"
      - name: "force"
        type: "boolean"
        required: false
        default: false
        description: "Force termination without cleanup"
    behavior:
      returns: "success confirmation"
      error_handling:
        - condition: "access_denied"
          response: "May require administrator privileges"

  - name: "start_application"
    description: |
      Launch an application or open a file with default program.
      Use when user wants to open apps or files.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Application path or file to open"
      - name: "arguments"
        type: "string"
        required: false
        description: "Command-line arguments"
      - name: "wait"
        type: "boolean"
        required: false
        default: false
        description: "Wait for application to close"
    behavior:
      returns: "process ID of launched application"

  # --- System Information Tools ---
  - name: "get_system_info"
    description: |
      Get detailed system information including OS, CPU, memory, disk.
      Use when user asks about their system specs or available resources.
    parameters: []
    behavior:
      returns: "object with os, cpu, memory, disk info"

  - name: "get_disk_usage"
    description: |
      Get disk space information for all drives.
      Use when user wants to check available storage.
    parameters:
      - name: "drive"
        type: "string"
        required: false
        description: "Specific drive letter (e.g., 'C:')"
    behavior:
      returns: "array of drive objects with total, used, free space"

  # --- Clipboard Tools ---
  - name: "get_clipboard"
    description: |
      Read current clipboard contents (text only).
      Use when user wants to work with copied text.
    parameters: []
    behavior:
      returns: "string with clipboard text content"

  - name: "set_clipboard"
    description: |
      Copy text to clipboard.
      Use when user wants to copy generated content.
    parameters:
      - name: "text"
        type: "string"
        required: true
        description: "Text to copy to clipboard"
    behavior:
      returns: "success confirmation"

  # --- Shell Execution ---
  - name: "run_powershell"
    description: |
      Execute a PowerShell command and return output.
      Use for advanced Windows automation tasks.
    parameters:
      - name: "command"
        type: "string"
        required: true
        description: "PowerShell command to execute"
      - name: "timeout"
        type: "number"
        required: false
        default: 30000
        description: "Timeout in milliseconds"
    behavior:
      returns: "object with stdout, stderr, exit code"
      error_handling:
        - condition: "timeout"
          response: "Command execution timed out"
        - condition: "execution_policy"
          response: "May need to adjust PowerShell execution policy"

  - name: "run_cmd"
    description: |
      Execute a CMD command and return output.
      Use for simple command-line operations.
    parameters:
      - name: "command"
        type: "string"
        required: true
        description: "CMD command to execute"
      - name: "timeout"
        type: "number"
        required: false
        default: 30000
        description: "Timeout in milliseconds"
    behavior:
      returns: "object with stdout, stderr, exit code"

# ----------------------------------------------------------------------------
# ACCEPTANCE CRITERIA
# ----------------------------------------------------------------------------
acceptance_criteria:
  functional:
    - id: "AC-001"
      description: "list_directory returns accurate file listing"
      test_method: "automated"
      priority: "must-have"

    - id: "AC-002"
      description: "File operations (read/write/copy/move/delete) work correctly"
      test_method: "automated"
      priority: "must-have"

    - id: "AC-003"
      description: "Process listing shows accurate CPU/memory stats"
      test_method: "manual"
      priority: "must-have"

    - id: "AC-004"
      description: "PowerShell/CMD execution captures output correctly"
      test_method: "automated"
      priority: "must-have"

  non_functional:
    - id: "NFR-001"
      category: "performance"
      description: "File operations complete within 5 seconds for typical files"

    - id: "NFR-002"
      category: "security"
      description: "No arbitrary code execution without explicit user command"

    - id: "NFR-003"
      category: "reliability"
      description: "Graceful handling of permission errors"

# ----------------------------------------------------------------------------
# SECURITY REQUIREMENTS
# ----------------------------------------------------------------------------
security:
  credentials:
    storage: "none"
    required_env_vars: []

  data_sensitivity:
    pii_handling: true
    data_encryption: false
    audit_logging: true

  access_control:
    require_user_confirmation:
      - "delete_file (with recursive=true)"
      - "kill_process"
      - "run_powershell"
      - "run_cmd"
    restricted_operations:
      - "System directory modifications"
      - "Registry access (not implemented in v1)"

# ----------------------------------------------------------------------------
# TESTING REQUIREMENTS
# ----------------------------------------------------------------------------
testing:
  unit_tests:
    coverage_target: 80
    frameworks: ["jest"]
    key_areas:
      - "Path validation and sanitization"
      - "Error handling for all tools"
      - "Process listing parsing"

  integration_tests:
    - name: "File operations end-to-end"
      description: "Create, read, modify, delete file cycle"
      mock_external: false

  manual_tests:
    - "Test with Claude Desktop on Windows"
    - "Verify admin-required operations fail gracefully"
    - "Test clipboard with various content"

# ----------------------------------------------------------------------------
# CONTEXT EFFICIENCY
# ----------------------------------------------------------------------------
context_efficiency:
  tool_count: 14
  estimated_tokens_per_call: 6300
  scope_recommendation:
    level: "project"
    rationale: |
      Windows system tools are typically used in focused automation sessions.
      Project-level installation is recommended for security.

# ----------------------------------------------------------------------------
# NOTES
# ----------------------------------------------------------------------------
notes: |
  **Dependencies:**
  - Node.js built-in: fs, path, child_process, os
  - clipboardy (for clipboard operations)
  - systeminformation (for system info)

  **Windows-Specific Considerations:**
  - Use PowerShell for advanced operations
  - Handle Windows path formats (backslashes)
  - Consider UAC elevation requirements
  - Test on Windows 10 and Windows 11

  **Future Enhancements:**
  - Registry read/write operations
  - Service management
  - Scheduled task creation
  - Network configuration
