# ============================================================================
# GRIMLOCK MCP SERVER PRD - Windows PowerShell & File System
# ============================================================================
# Purpose: MCP server for Windows PowerShell execution and file operations
# Version: 1.0.0
# ============================================================================

# ----------------------------------------------------------------------------
# PROJECT METADATA
# ----------------------------------------------------------------------------
project:
  name: "windows-mcp"
  version: "0.1.0"
  description: |
    Windows MCP server providing AI assistants with PowerShell execution
    and file system operations (CRUD). Enables Claude to automate Windows
    tasks, manage files, and execute scripts for users.

  sdk: "typescript"
  node_version: "18+"

  deployment:
    type: "local"
    transport: "stdio"
    containerized: false

  delivery:
    method: "customer_repo"
    customer_repo_url: "https://github.com/m2ai-mcp-servers/mcp-windows"

# ----------------------------------------------------------------------------
# TARGET INTEGRATION
# ----------------------------------------------------------------------------
integration:
  service_name: "Windows OS"
  service_type: "filesystem"

  api:
    base_url: null
    documentation_url: "https://nodejs.org/api/"
    rate_limits: null

  auth:
    type: "none"

# ----------------------------------------------------------------------------
# MCP TOOLS SPECIFICATION
# ----------------------------------------------------------------------------
tools:
  # --- PowerShell Execution ---
  - name: "run_powershell"
    description: |
      Execute a PowerShell command and return output.
      Use for any Windows automation, system queries, or script execution.
    parameters:
      - name: "command"
        type: "string"
        required: true
        description: "PowerShell command or script to execute"
      - name: "timeout"
        type: "number"
        required: false
        default: 30000
        description: "Timeout in milliseconds (max 60000)"
        validation:
          minimum: 1000
          maximum: 60000
    behavior:
      returns: "object with stdout, stderr, exitCode"
      error_handling:
        - condition: "timeout"
          response: "Command execution timed out"
        - condition: "execution_policy"
          response: "May need to adjust PowerShell execution policy"
        - condition: "access_denied"
          response: "May require administrator privileges"
    examples:
      - input:
          command: "Get-Process | Select-Object -First 5"
        expected_output: |
          { "stdout": "Process list...", "stderr": "", "exitCode": 0 }
      - input:
          command: "Get-ChildItem C:\\Users"
        expected_output: |
          { "stdout": "Directory listing...", "stderr": "", "exitCode": 0 }

  # --- File System: List ---
  - name: "list_directory"
    description: |
      List contents of a directory.
      Use when user wants to see files in a folder.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Directory path (e.g., 'C:\\Users\\Name\\Documents')"
      - name: "recursive"
        type: "boolean"
        required: false
        default: false
        description: "Include subdirectories"
    behavior:
      returns: "array of file/folder objects with name, size, modified date, isDirectory"
      error_handling:
        - condition: "path_not_found"
          response: "Directory not found at specified path"
        - condition: "access_denied"
          response: "Permission denied - may need admin rights"
    examples:
      - input:
          path: "C:\\Users\\Public"
        expected_output: |
          [{ "name": "Documents", "isDirectory": true, "size": 0, "modified": "2024-01-01" }]

  # --- File System: Read ---
  - name: "read_file"
    description: |
      Read contents of a text file.
      Use when user wants to view file contents.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Full path to the file"
      - name: "encoding"
        type: "string"
        required: false
        default: "utf8"
        description: "File encoding"
        validation:
          enum: ["utf8", "ascii", "utf16le", "base64"]
    behavior:
      returns: "string with file contents"
      error_handling:
        - condition: "file_not_found"
          response: "File not found at specified path"
        - condition: "binary_file"
          response: "File appears to be binary - use base64 encoding"
        - condition: "too_large"
          response: "File exceeds 10MB limit"
    examples:
      - input:
          path: "C:\\Users\\Name\\config.txt"
        expected_output: |
          "File contents as string..."

  # --- File System: Write ---
  - name: "write_file"
    description: |
      Write content to a file (create or overwrite).
      Use when user wants to create or modify files.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Full path for the file"
      - name: "content"
        type: "string"
        required: true
        description: "Content to write"
      - name: "append"
        type: "boolean"
        required: false
        default: false
        description: "Append to existing file instead of overwrite"
    behavior:
      returns: "object with success status and bytes written"
      error_handling:
        - condition: "access_denied"
          response: "Permission denied - check folder permissions"
        - condition: "disk_full"
          response: "Insufficient disk space"
    examples:
      - input:
          path: "C:\\Users\\Name\\test.txt"
          content: "Hello World"
        expected_output: |
          { "success": true, "bytesWritten": 11, "path": "C:\\Users\\Name\\test.txt" }

  # --- File System: Delete ---
  - name: "delete_file"
    description: |
      Delete a file or directory.
      Use with caution - always confirm with user first.
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Path to delete"
      - name: "recursive"
        type: "boolean"
        required: false
        default: false
        description: "Delete directory and all contents (dangerous)"
    behavior:
      returns: "object with success status"
      error_handling:
        - condition: "not_found"
          response: "File or directory not found"
        - condition: "in_use"
          response: "File is in use by another process"
        - condition: "access_denied"
          response: "Permission denied"
    examples:
      - input:
          path: "C:\\Users\\Name\\temp.txt"
        expected_output: |
          { "success": true, "deleted": "C:\\Users\\Name\\temp.txt" }

# ----------------------------------------------------------------------------
# ACCEPTANCE CRITERIA
# ----------------------------------------------------------------------------
acceptance_criteria:
  functional:
    - id: "AC-001"
      description: "run_powershell executes commands and returns output"
      test_method: "automated"
      priority: "must-have"

    - id: "AC-002"
      description: "list_directory returns accurate file listing"
      test_method: "automated"
      priority: "must-have"

    - id: "AC-003"
      description: "read_file returns file contents correctly"
      test_method: "automated"
      priority: "must-have"

    - id: "AC-004"
      description: "write_file creates and overwrites files"
      test_method: "automated"
      priority: "must-have"

    - id: "AC-005"
      description: "delete_file removes files safely"
      test_method: "automated"
      priority: "must-have"

  non_functional:
    - id: "NFR-001"
      category: "performance"
      description: "File operations complete within 5 seconds"

    - id: "NFR-002"
      category: "security"
      description: "No arbitrary code execution without explicit command"

    - id: "NFR-003"
      category: "reliability"
      description: "Graceful handling of permission errors"

# ----------------------------------------------------------------------------
# SECURITY REQUIREMENTS
# ----------------------------------------------------------------------------
security:
  credentials:
    storage: "none"
    required_env_vars: []

  data_sensitivity:
    pii_handling: true
    data_encryption: false
    audit_logging: true

  access_control:
    require_user_confirmation:
      - "delete_file (with recursive=true)"
      - "run_powershell (destructive commands)"
    restricted_operations:
      - "System32 modifications"
      - "Registry access"

# ----------------------------------------------------------------------------
# TESTING REQUIREMENTS
# ----------------------------------------------------------------------------
testing:
  unit_tests:
    coverage_target: 80
    frameworks: ["jest"]
    key_areas:
      - "Path validation and sanitization"
      - "PowerShell command escaping"
      - "Error handling"

  integration_tests:
    - name: "File CRUD cycle"
      description: "Create, read, update, delete file"
      mock_external: false

  manual_tests:
    - "Test with Claude Desktop on Windows"
    - "Verify admin-required operations fail gracefully"
    - "Test PowerShell with various commands"

# ----------------------------------------------------------------------------
# CONTEXT EFFICIENCY
# ----------------------------------------------------------------------------
context_efficiency:
  tool_count: 5
  estimated_tokens_per_call: 2700
  scope_recommendation:
    level: "project"
    rationale: |
      5 tools is optimal. PowerShell provides flexibility for complex
      operations while file CRUD covers common use cases.

# ----------------------------------------------------------------------------
# NOTES
# ----------------------------------------------------------------------------
notes: |
  **Dependencies:**
  - Node.js built-in: fs, path, child_process

  **Windows-Specific Considerations:**
  - Handle Windows path formats (backslashes)
  - PowerShell execution policy may need adjustment
  - Consider UAC elevation requirements
  - Test on Windows 10 and Windows 11

  **PowerShell Notes:**
  - run_powershell is the "escape hatch" for anything not covered by CRUD tools
  - Can query processes, services, registry (read), network, etc.
  - Consider command sanitization for security

  **Future Enhancements:**
  - copy_file and move_file tools
  - Registry read/write operations
  - Service management
