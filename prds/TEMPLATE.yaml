# ============================================================================
# GRIMLOCK MCP SERVER PRD TEMPLATE
# ============================================================================
# Purpose: Specification document for autonomous MCP server development
# Sprint Model: Week 1 (Requirements) -> Friday-Monday (Grimlock Build) -> Week 2 (Refinement)
# Version: 2.0.0
# ============================================================================

# ----------------------------------------------------------------------------
# PROJECT METADATA
# ----------------------------------------------------------------------------
project:
  name: "[MCP_SERVER_NAME]"                    # e.g., "ratchet-mcp", "notion-sync-mcp"
  version: "0.1.0"
  description: |
    [One paragraph describing what this MCP server does and why it exists]

  # Sprint Planning
  sprint:
    week_1_start: "YYYY-MM-DD"                 # Requirements gathering begins
    grimlock_handoff: "YYYY-MM-DD HH:MM"       # Friday EOD handoff
    grimlock_delivery: "YYYY-MM-DD HH:MM"      # Monday AM expected delivery
    week_2_end: "YYYY-MM-DD"                   # Production deployment target

  # Technical Stack
  sdk: "typescript"                            # Options: python, typescript
  python_version: "3.11+"                      # If SDK is Python
  node_version: "18+"                          # If SDK is TypeScript

  # Deployment Target
  deployment:
    type: "local"                              # Options: local, remote, hybrid
    transport: "stdio"                         # Options: stdio, http, sse
    containerized: false                       # Docker deployment?

  # Delivery Configuration
  # See docs/DELIVERY_WORKFLOW.md for details
  delivery:
    method: "customer_repo"                    # Options: customer_repo, staging_transfer, artifact

    # For customer_repo method (recommended)
    customer_repo_url: ""                      # e.g., "https://github.com/customer-org/project.git"

    # For staging_transfer method
    customer_github_username: ""               # GitHub username to transfer repo to

    # For artifact method
    artifact_retention_days: 30                # Days to keep artifact before deletion

# ----------------------------------------------------------------------------
# TARGET INTEGRATION
# ----------------------------------------------------------------------------
integration:
  service_name: "[SERVICE_NAME]"               # e.g., "Notion", "GitHub", "Custom API"
  service_type: "api"                          # Options: api, database, filesystem, hybrid

  # API Details (if applicable)
  api:
    base_url: "https://api.example.com/v1"
    documentation_url: "https://docs.example.com"
    rate_limits:
      requests_per_minute: 60
      requests_per_day: 10000

  # Authentication
  auth:
    type: "oauth2"                             # Options: oauth2, api_key, bearer, basic, none
    oauth2:
      authorization_url: "https://example.com/oauth/authorize"
      token_url: "https://example.com/oauth/token"
      scopes:
        - "read:data"
        - "write:data"
      flow: "authorization_code"               # Options: authorization_code, client_credentials
    api_key:
      header_name: "X-API-Key"                 # If auth type is api_key
      env_variable: "EXAMPLE_API_KEY"

# ----------------------------------------------------------------------------
# MCP TOOLS SPECIFICATION
# ----------------------------------------------------------------------------
# Tools are model-controlled actions the AI can invoke
tools:
  - name: "tool_name_snake_case"
    description: |
      Clear description of what this tool does.
      Include when the AI should use this tool.

    # Input Parameters
    parameters:
      - name: "param_name"
        type: "string"                         # Options: string, number, boolean, array, object
        required: true
        description: "What this parameter controls"
        validation:
          pattern: "^[a-z]+$"                  # Regex pattern (optional)
          min_length: 1                        # For strings
          max_length: 100
          enum: ["option1", "option2"]         # Allowed values (optional)

      - name: "optional_param"
        type: "number"
        required: false
        default: 10
        description: "Optional parameter with default"
        validation:
          minimum: 1
          maximum: 100

    # Expected Behavior
    behavior:
      api_endpoint: "GET /api/resource/{param_name}"
      returns: "object"                        # What type is returned
      error_handling:
        - condition: "resource_not_found"
          response: "Return helpful message about missing resource"
        - condition: "rate_limited"
          response: "Inform user to wait, suggest retry"

    # Example Usage
    examples:
      - input:
          param_name: "example_value"
        expected_output: |
          Description of what should be returned
      - input:
          param_name: "edge_case"
        expected_output: |
          How edge cases should be handled

  # Add more tools following the same structure
  # - name: "another_tool"
  #   description: "..."
  #   parameters: []
  #   behavior: {}
  #   examples: []

# ----------------------------------------------------------------------------
# MCP RESOURCES SPECIFICATION
# ----------------------------------------------------------------------------
# Resources are application-controlled data sources
resources:
  - uri: "resource://example/data"
    name: "Example Data Resource"
    description: |
      What data this resource provides.
      How it should be used by the application.
    mime_type: "application/json"

    # Data Schema
    schema:
      type: "object"
      properties:
        id:
          type: "string"
        name:
          type: "string"
        data:
          type: "array"
          items:
            type: "object"

# ----------------------------------------------------------------------------
# MCP PROMPTS SPECIFICATION
# ----------------------------------------------------------------------------
# Prompts are user-controlled templates
prompts:
  - name: "example_prompt"
    description: |
      When users should use this prompt template.

    arguments:
      - name: "context"
        description: "Context for the prompt"
        required: true

    template: |
      Given the following context: {{context}}

      Please analyze and provide insights on...

# ----------------------------------------------------------------------------
# ACCEPTANCE CRITERIA
# ----------------------------------------------------------------------------
acceptance_criteria:
  # Functional Requirements
  functional:
    - id: "AC-001"
      description: "Tool X successfully retrieves data when given valid input"
      test_method: "manual"                    # Options: manual, automated, both
      priority: "must-have"                    # Options: must-have, should-have, nice-to-have

    - id: "AC-002"
      description: "Tool X returns appropriate error for invalid input"
      test_method: "automated"
      priority: "must-have"

  # Non-Functional Requirements
  non_functional:
    - id: "NFR-001"
      category: "performance"
      description: "Response time under 2 seconds for standard queries"

    - id: "NFR-002"
      category: "security"
      description: "API keys never logged or exposed in responses"

    - id: "NFR-003"
      category: "reliability"
      description: "Graceful degradation when API is unavailable"

# ----------------------------------------------------------------------------
# SECURITY REQUIREMENTS
# ----------------------------------------------------------------------------
security:
  # Credential Handling
  credentials:
    storage: "environment_variables"           # Never hardcode
    required_env_vars:
      - name: "EXAMPLE_API_KEY"
        description: "API key for Example service"
      - name: "EXAMPLE_CLIENT_SECRET"
        description: "OAuth client secret"

  # Data Handling
  data_sensitivity:
    pii_handling: false                        # Does this handle PII?
    data_encryption: false                     # Encrypt data at rest?
    audit_logging: true                        # Log all operations?

  # Access Control
  access_control:
    require_user_confirmation: []              # Tools requiring user confirmation
    restricted_operations: []                  # Operations with extra security

# ----------------------------------------------------------------------------
# TESTING REQUIREMENTS
# ----------------------------------------------------------------------------
testing:
  # Unit Tests
  unit_tests:
    coverage_target: 80                        # Percentage
    frameworks: ["jest"]                       # For TypeScript
    key_areas:
      - "Parameter validation"
      - "API response parsing"
      - "Error handling"

  # Integration Tests
  integration_tests:
    - name: "End-to-end tool execution"
      description: "Test full flow from MCP client to API and back"
      mock_external: true                      # Use mocked API responses

  # Manual Testing
  manual_tests:
    - "Test with Claude Desktop"
    - "Test with MCP Inspector"
    - "Verify error messages are helpful"

# ----------------------------------------------------------------------------
# DOCUMENTATION REQUIREMENTS
# ----------------------------------------------------------------------------
documentation:
  required:
    - type: "README.md"
      contents:
        - "Installation instructions"
        - "Configuration (env vars)"
        - "Available tools with examples"
        - "Troubleshooting common issues"

    - type: "CHANGELOG.md"
      contents:
        - "Version history"
        - "Breaking changes"

    - type: "inline_comments"
      contents:
        - "Complex logic explanation"
        - "API quirks and workarounds"

# ----------------------------------------------------------------------------
# GRIMLOCK HANDOFF CHECKLIST
# ----------------------------------------------------------------------------
# Items that must be provided to Grimlock at Friday EOD handoff
grimlock_handoff:
  required_inputs:
    - item: "This completed PRD"
      status: "pending"                        # pending, ready

    - item: "API documentation or OpenAPI spec"
      status: "pending"
      location: "[URL or file path]"

    - item: "Sample API responses"
      status: "pending"
      notes: "Include success and error examples"

    - item: "Test credentials (non-production)"
      status: "pending"
      notes: "Stored in .env.example format"

    - item: "Example use cases"
      status: "pending"
      notes: "3-5 scenarios the MCP should handle"

  context_files:
    - "[List any relevant context files Grimlock should read]"

  constraints:
    - "Do not use deprecated API endpoints"
    - "Follow TypeScript strict mode"
    - "Use async/await for API calls"

# ----------------------------------------------------------------------------
# WEEK 2 REFINEMENT CHECKLIST
# ----------------------------------------------------------------------------
# Items for human review after Grimlock delivery
week2_refinement:
  security_review:
    - "Verify no credentials in code"
    - "Check input validation"
    - "Review error messages for info leakage"
    - "Test OAuth flow manually"

  integration_testing:
    - "Test with real API (production-like)"
    - "Verify rate limit handling"
    - "Test concurrent requests"
    - "Validate with Claude Desktop"

  production_hardening:
    - "Add comprehensive logging"
    - "Set up monitoring/alerting"
    - "Configure for deployment target"
    - "Performance optimization if needed"

  documentation_review:
    - "README accuracy"
    - "Example commands work"
    - "Troubleshooting section complete"

# ----------------------------------------------------------------------------
# SUCCESS METRICS
# ----------------------------------------------------------------------------
success_metrics:
  grimlock_delivery:
    - "All tools implemented and functional"
    - "Basic tests passing"
    - "Setup documentation complete"
    - "Can be tested with MCP Inspector"

  production_ready:
    - "All acceptance criteria met"
    - "Security review passed"
    - "Documentation complete"
    - "Deployed to target environment"
    - "Monitoring in place"

# ----------------------------------------------------------------------------
# NOTES & CONTEXT
# ----------------------------------------------------------------------------
notes: |
  Additional context for Grimlock or human reviewers.

  Include:
  - Known API quirks or limitations
  - Design decisions and rationale
  - Future enhancement ideas
  - Related projects or dependencies

# ============================================================================
# CONTEXT EFFICIENCY SECTION
# ============================================================================
# Populated by Design Wizard or manually calculated
# See docs/MCP_BEST_PRACTICES.md for guidelines
context_efficiency:
  # Tool metrics
  tool_count: 0                           # Number of tools defined
  estimated_tokens_per_call: 0            # ~450 per tool + 30 per param

  # Scope recommendation
  scope_recommendation:
    level: "project"                      # Options: project, user, split_required
    rationale: |
      [Why this scope was recommended]

  # Description efficiency
  description_stats:
    average_length: 0                     # Average chars per description
    max_length: 0                         # Longest description
    over_threshold: 0                     # Count of descriptions > 150 chars

  # Parameter efficiency
  parameter_stats:
    average_per_tool: 0                   # Average params per tool
    max_per_tool: 0                       # Most params on single tool

  # Variant information (if split)
  variant_strategy:
    type: "single"                        # Options: single, core_lite, core_plus_advanced
    variants: []                          # List of variant names if split

  # Warnings acknowledged during design
  warnings_acknowledged: []
  # Format:
  # - id: "W001"
  #   message: "Tool count warning"
  #   acknowledged_at: "2024-12-23T10:30:00Z"
  #   user_response: "Proceed - all tools essential"

# ============================================================================
# DESIGN ORIGIN SECTION
# ============================================================================
# Tracks how this PRD was created
design_origin:
  source: "manual"                        # Options: design_wizard, manual, template_clone
  session_id: null                        # Design session ID if from wizard
  interface: null                         # slack, claude_code, or null if manual

  # Summary of design conversation (auto-populated by wizard)
  conversation_summary: |
    [How this PRD was created - key decisions made]

  # Design metadata
  design_duration_minutes: null           # How long the design session took
  designed_at: null                       # When design was completed

  # Post-design modifications
  human_refinements: []
  # Format:
  # - date: "2024-12-24"
  #   change: "Added error handling for rate limits"
  #   reason: "Discovered during testing"
